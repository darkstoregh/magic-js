var lt=Object.create;var U=Object.defineProperty,ft=Object.defineProperties,ht=Object.getOwnPropertyDescriptor,ut=Object.getOwnPropertyDescriptors,pt=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,vt=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable;var X=(o,s,a)=>s in o?U(o,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[s]=a,tt=(o,s)=>{for(var a in s||(s={}))Z.call(s,a)&&X(o,a,s[a]);if(Q)for(var a of Q(s))mt.call(s,a)&&X(o,a,s[a]);return o},et=(o,s)=>ft(o,ut(s));var dt=(o,s)=>()=>(s||o((s={exports:{}}).exports,s),s.exports);var yt=(o,s,a,l)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of pt(s))!Z.call(o,c)&&c!==a&&U(o,c,{get:()=>s[c],enumerable:!(l=ht(s,c))||l.enumerable});return o};var gt=(o,s,a)=>(a=o!=null?lt(vt(o)):{},yt(s||!o||!o.__esModule?U(a,"default",{value:o,enumerable:!0}):a,o));var k=(o,s,a)=>new Promise((l,c)=>{var y=f=>{try{w(a.next(f))}catch(S){c(S)}},u=f=>{try{w(a.throw(f))}catch(S){c(S)}},w=f=>f.done?l(f.value):Promise.resolve(f.value).then(y,u);w((a=a.apply(o,s)).next())});var rt=dt((Ct,K)=>{var $=function(o){"use strict";var s=Object.prototype,a=s.hasOwnProperty,l,c=typeof Symbol=="function"?Symbol:{},y=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",w=c.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch{f=function(t,r,i){return t[r]=i}}function S(e,t,r,i){var n=t&&t.prototype instanceof P?t:P,h=Object.create(n.prototype),p=new W(i||[]);return h._invoke=st(e,r,p),h}o.wrap=S;function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(i){return{type:"throw",arg:i}}}var F="suspendedStart",at="suspendedYield",J="executing",R="completed",g={};function P(){}function M(){}function E(){}var D={};f(D,y,function(){return this});var T=Object.getPrototypeOf,G=T&&T(T(Y([])));G&&G!==s&&a.call(G,y)&&(D=G);var _=E.prototype=P.prototype=Object.create(D);M.prototype=E,f(_,"constructor",E),f(E,"constructor",M),M.displayName=f(E,w,"GeneratorFunction");function H(e){["next","throw","return"].forEach(function(t){f(e,t,function(r){return this._invoke(t,r)})})}o.isGeneratorFunction=function(e){var t=typeof e=="function"&&e.constructor;return t?t===M||(t.displayName||t.name)==="GeneratorFunction":!1},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,f(e,w,"GeneratorFunction")),e.prototype=Object.create(_),e},o.awrap=function(e){return{__await:e}};function V(e,t){function r(h,p,v,d){var m=b(e[h],e,p);if(m.type==="throw")d(m.arg);else{var j=m.arg,O=j.value;return O&&typeof O=="object"&&a.call(O,"__await")?t.resolve(O.__await).then(function(L){r("next",L,v,d)},function(L){r("throw",L,v,d)}):t.resolve(O).then(function(L){j.value=L,v(j)},function(L){return r("throw",L,v,d)})}}var i;function n(h,p){function v(){return new t(function(d,m){r(h,p,d,m)})}return i=i?i.then(v,v):v()}this._invoke=n}H(V.prototype),f(V.prototype,u,function(){return this}),o.AsyncIterator=V,o.async=function(e,t,r,i,n){n===void 0&&(n=Promise);var h=new V(S(e,t,r,i),n);return o.isGeneratorFunction(t)?h:h.next().then(function(p){return p.done?p.value:h.next()})};function st(e,t,r){var i=F;return function(h,p){if(i===J)throw new Error("Generator is already running");if(i===R){if(h==="throw")throw p;return x()}for(r.method=h,r.arg=p;;){var v=r.delegate;if(v){var d=q(v,r);if(d){if(d===g)continue;return d}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(i===F)throw i=R,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);i=J;var m=b(e,t,r);if(m.type==="normal"){if(i=r.done?R:at,m.arg===g)continue;return{value:m.arg,done:r.done}}else m.type==="throw"&&(i=R,r.method="throw",r.arg=m.arg)}}}function q(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=l,q(e,t),t.method==="throw"))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=b(r,e.iterator,t.arg);if(i.type==="throw")return t.method="throw",t.arg=i.arg,t.delegate=null,g;var n=i.arg;if(!n)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g;if(n.done)t[e.resultName]=n.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=l);else return n;return t.delegate=null,g}H(_),f(_,w,"Generator"),f(_,y,function(){return this}),f(_,"toString",function(){return"[object Generator]"});function ct(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function W(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(ct,this),this.reset(!0)}o.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function i(){for(;t.length;){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}};function Y(e){if(e){var t=e[y];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(a.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=l,n.done=!0,n};return i.next=i}}return{next:x}}o.values=Y;function x(){return{value:l,done:!0}}return W.prototype={constructor:W,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(C),!e)for(var t in this)t.charAt(0)==="t"&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if(t.type==="throw")throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(d,m){return h.type="throw",h.arg=e,t.next=d,m&&(t.method="next",t.arg=l),!!m}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],h=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var p=a.call(n,"catchLoc"),v=a.call(n,"finallyLoc");if(p&&v){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(p){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(v){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&(e==="break"||e==="continue")&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var h=n?n.completion:{};return h.type=e,h.arg=t,n?(this.method="next",this.next=n.finallyLoc,g):this.complete(h)},complete:function(e,t){if(e.type==="throw")throw e.arg;return e.type==="break"||e.type==="continue"?this.next=e.arg:e.type==="return"?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):e.type==="normal"&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if(i.type==="throw"){var n=i.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:Y(e),resultName:t,nextLoc:r},this.method==="next"&&(this.arg=l),g}},o}(typeof K=="object"?K.exports:{});try{regeneratorRuntime=$}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=$:Function("r","regeneratorRuntime = r")($)}});var Ft=gt(rt());import{createSDK as Vt}from"@magic-sdk/provider";import*as kt from"process";import Nt from"localforage";import{URL as It,URLSearchParams as Pt}from"whatwg-url";import{Buffer as B}from"buffer";import*as ot from"lodash";import*as it from"expo-application";import{driverWithoutSerialization as Dt}from"@aveq-research/localforage-asyncstorage-driver";import*as z from"localforage-driver-memory";import nt,{useState as wt,useCallback as A,useMemo as bt}from"react";import{StyleSheet as St,View as Et}from"react-native";import{WebView as Lt}from"react-native-webview";import{ViewController as _t,createModalNotReadyError as Ot}from"@magic-sdk/provider";import{isTypedArray as At}from"lodash";var Rt="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY";function Mt(){return St.create({"magic-webview":{flex:1,backgroundColor:"transparent"},"webview-container":{flex:1,width:"100%",backgroundColor:"transparent",position:"absolute",top:0,left:0,right:0,bottom:0},show:{zIndex:1e4,elevation:1e4},hide:{zIndex:-1e4,elevation:0}})}var N=class extends _t{constructor(){super(...arguments);this.Relayer=()=>{let[a,l]=wt(!1),c=A(b=>{this.webView=b},[]),y=A(b=>{this.container=et(tt({},b),{showOverlay:u,hideOverlay:w})},[]),u=A(()=>{l(!0)},[]),w=A(()=>{l(!1)},[]),f=bt(()=>[this.styles["webview-container"],a?this.styles.show:this.styles.hide],[a]),S=A(b=>{this.handleReactNativeWebViewMessage(b)},[]);return nt.createElement(Et,{ref:y,style:f},nt.createElement(Lt,{ref:c,source:{uri:`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`},onMessage:S,style:this.styles["magic-webview"]}))}}init(){this.webView=null,this.container=null,this.styles=Mt()}handleReactNativeWebViewMessage(a){var l;if(a.nativeEvent&&typeof a.nativeEvent.data=="string"&&(a.nativeEvent.url===`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`||a.nativeEvent.url===`${this.endpoint}/send/?params=${this.parameters}`)){let c=JSON.parse(a.nativeEvent.data,(y,u)=>{try{if(u&&typeof u=="object"&&u.flag&&u.flag==="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY")return new global[u.constructor](u.data.split(","))}catch(w){}return u});if(c&&c.msgType&&this.messageHandlers.size){c.response=(l=c.response)!=null?l:{};let y={data:c};for(let u of this.messageHandlers.values())u(y)}}}hideOverlay(){this.container&&this.container.hideOverlay()}showOverlay(){this.container&&this.container.showOverlay()}_post(a){return k(this,null,function*(){if(this.webView&&this.webView.postMessage)this.webView.postMessage(JSON.stringify(a,(l,c)=>At(c)?{constructor:c.constructor.name,data:c.toString(),flag:Rt}:c),this.endpoint);else throw Ot()})}};import{SDKBase as Gt}from"@magic-sdk/provider";var I=class extends Gt{get Relayer(){return this.overlay.Relayer}};export*from"@magic-sdk/commons";global.process=ot.merge(global.process,kt);global.process.browser=!1;global.Buffer=B;global.URL=It;global.URLSearchParams=Pt;global.btoa=o=>B.from(o,"binary").toString("base64");global.atob=o=>B.from(o,"base64").toString("binary");var re=Vt(I,{platform:"react-native",sdkName:"@magic-sdk/react-native",version:"11.0.0",bundleId:it.applicationId,defaultEndpoint:"https://box.magic.link/",ViewController:N,configureStorage:()=>k(void 0,null,function*(){let o=Nt.createInstance({name:"MagicAuthLocalStorageDB",storeName:"MagicAuthLocalStorage"}),s=Dt();return yield Promise.all([o.defineDriver(s),o.defineDriver(z)]),yield o.setDriver([s._driver,z._driver]),o})});export{re as Magic};
//# sourceMappingURL=index.js.map
