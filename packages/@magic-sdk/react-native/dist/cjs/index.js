"use strict";var St=Object.create;var V=Object.defineProperty,Et=Object.defineProperties,Lt=Object.getOwnPropertyDescriptor,_t=Object.getOwnPropertyDescriptors,Ot=Object.getOwnPropertyNames,ot=Object.getOwnPropertySymbols,At=Object.getPrototypeOf,at=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var it=(n,s,i)=>s in n?V(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i,st=(n,s)=>{for(var i in s||(s={}))at.call(s,i)&&it(n,i,s[i]);if(ot)for(var i of ot(s))Rt.call(s,i)&&it(n,i,s[i]);return n},ct=(n,s)=>Et(n,_t(s));var Mt=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports),Gt=(n,s)=>{for(var i in s)V(n,i,{get:s[i],enumerable:!0})},D=(n,s,i,h)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of Ot(s))!at.call(n,c)&&c!==i&&V(n,c,{get:()=>s[c],enumerable:!(h=Lt(s,c))||h.enumerable});return n},f=(n,s,i)=>(D(n,s,"default"),i&&D(i,s,"default")),R=(n,s,i)=>(i=n!=null?St(At(n)):{},D(s||!n||!n.__esModule?V(i,"default",{value:n,enumerable:!0}):i,n)),Vt=n=>D(V({},"__esModule",{value:!0}),n);var T=(n,s,i)=>new Promise((h,c)=>{var b=u=>{try{E(i.next(u))}catch(_){c(_)}},v=u=>{try{E(i.throw(u))}catch(_){c(_)}},E=u=>u.done?h(u.value):Promise.resolve(u.value).then(b,v);E((i=i.apply(n,s)).next())});var lt=Mt((Tt,Q)=>{var x=function(n){"use strict";var s=Object.prototype,i=s.hasOwnProperty,h,c=typeof Symbol=="function"?Symbol:{},b=c.iterator||"@@iterator",v=c.asyncIterator||"@@asyncIterator",E=c.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch{u=function(t,r,a){return t[r]=a}}function _(e,t,r,a){var o=t&&t.prototype instanceof K?t:K,p=Object.create(o.prototype),m=new J(a||[]);return p._invoke=wt(e,r,m),p}n.wrap=_;function L(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(a){return{type:"throw",arg:a}}}var Z="suspendedStart",gt="suspendedYield",tt="executing",k="completed",S={};function K(){}function N(){}function O(){}var B={};u(B,b,function(){return this});var z=Object.getPrototypeOf,I=z&&z(z(H([])));I&&I!==s&&i.call(I,b)&&(B=I);var M=O.prototype=K.prototype=Object.create(B);N.prototype=O,u(M,"constructor",O),u(O,"constructor",N),N.displayName=u(O,E,"GeneratorFunction");function et(e){["next","throw","return"].forEach(function(t){u(e,t,function(r){return this._invoke(t,r)})})}n.isGeneratorFunction=function(e){var t=typeof e=="function"&&e.constructor;return t?t===N||(t.displayName||t.name)==="GeneratorFunction":!1},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,O):(e.__proto__=O,u(e,E,"GeneratorFunction")),e.prototype=Object.create(M),e},n.awrap=function(e){return{__await:e}};function P(e,t){function r(p,m,d,w){var y=L(e[p],e,m);if(y.type==="throw")w(y.arg);else{var q=y.arg,G=q.value;return G&&typeof G=="object"&&i.call(G,"__await")?t.resolve(G.__await).then(function(A){r("next",A,d,w)},function(A){r("throw",A,d,w)}):t.resolve(G).then(function(A){q.value=A,d(q)},function(A){return r("throw",A,d,w)})}}var a;function o(p,m){function d(){return new t(function(w,y){r(p,m,w,y)})}return a=a?a.then(d,d):d()}this._invoke=o}et(P.prototype),u(P.prototype,v,function(){return this}),n.AsyncIterator=P,n.async=function(e,t,r,a,o){o===void 0&&(o=Promise);var p=new P(_(e,t,r,a),o);return n.isGeneratorFunction(t)?p:p.next().then(function(m){return m.done?m.value:p.next()})};function wt(e,t,r){var a=Z;return function(p,m){if(a===tt)throw new Error("Generator is already running");if(a===k){if(p==="throw")throw m;return nt()}for(r.method=p,r.arg=m;;){var d=r.delegate;if(d){var w=rt(d,r);if(w){if(w===S)continue;return w}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(a===Z)throw a=k,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);a=tt;var y=L(e,t,r);if(y.type==="normal"){if(a=r.done?k:gt,y.arg===S)continue;return{value:y.arg,done:r.done}}else y.type==="throw"&&(a=k,r.method="throw",r.arg=y.arg)}}}function rt(e,t){var r=e.iterator[t.method];if(r===h){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=h,rt(e,t),t.method==="throw"))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var a=L(r,e.iterator,t.arg);if(a.type==="throw")return t.method="throw",t.arg=a.arg,t.delegate=null,S;var o=a.arg;if(!o)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S;if(o.done)t[e.resultName]=o.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=h);else return o;return t.delegate=null,S}et(M),u(M,E,"Generator"),u(M,b,function(){return this}),u(M,"toString",function(){return"[object Generator]"});function bt(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function J(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(bt,this),this.reset(!0)}n.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function a(){for(;t.length;){var o=t.pop();if(o in e)return a.value=o,a.done=!1,a}return a.done=!0,a}};function H(e){if(e){var t=e[b];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var r=-1,a=function o(){for(;++r<e.length;)if(i.call(e,r))return o.value=e[r],o.done=!1,o;return o.value=h,o.done=!0,o};return a.next=a}}return{next:nt}}n.values=H;function nt(){return{value:h,done:!0}}return J.prototype={constructor:J,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(F),!e)for(var t in this)t.charAt(0)==="t"&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=h)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if(t.type==="throw")throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(w,y){return p.type="throw",p.arg=e,t.next=w,y&&(t.method="next",t.arg=h),!!y}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],p=o.completion;if(o.tryLoc==="root")return r("end");if(o.tryLoc<=this.prev){var m=i.call(o,"catchLoc"),d=i.call(o,"finallyLoc");if(m&&d){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(m){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else if(d){if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&(e==="break"||e==="continue")&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var p=o?o.completion:{};return p.type=e,p.arg=t,o?(this.method="next",this.next=o.finallyLoc,S):this.complete(p)},complete:function(e,t){if(e.type==="throw")throw e.arg;return e.type==="break"||e.type==="continue"?this.next=e.arg:e.type==="return"?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):e.type==="normal"&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if(a.type==="throw"){var o=a.arg;F(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:H(e),resultName:t,nextLoc:r},this.method==="next"&&(this.arg=h),S}},n}(typeof Q=="object"?Q.exports:{});try{regeneratorRuntime=x}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=x:Function("r","regeneratorRuntime = r")(x)}});var l={};Gt(l,{Magic:()=>Pt});module.exports=Vt(l);var Yt=R(lt()),pt=require("@magic-sdk/provider"),It=R(require("process")),vt=R(require("localforage")),U=require("whatwg-url"),$=require("buffer"),mt=R(require("lodash")),dt=R(require("expo-application")),yt=require("@aveq-research/localforage-asyncstorage-driver"),X=R(require("localforage-driver-memory"));var g=R(require("react")),W=require("react-native"),ft=require("react-native-webview"),Y=require("@magic-sdk/provider"),ht=require("lodash");var kt="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY";function Nt(){return W.StyleSheet.create({"magic-webview":{flex:1,backgroundColor:"transparent"},"webview-container":{flex:1,width:"100%",backgroundColor:"transparent",position:"absolute",top:0,left:0,right:0,bottom:0},show:{zIndex:1e4,elevation:1e4},hide:{zIndex:-1e4,elevation:0}})}var C=class extends Y.ViewController{constructor(){super(...arguments);this.Relayer=()=>{let[i,h]=(0,g.useState)(!1),c=(0,g.useCallback)(L=>{this.webView=L},[]),b=(0,g.useCallback)(L=>{this.container=ct(st({},L),{showOverlay:v,hideOverlay:E})},[]),v=(0,g.useCallback)(()=>{h(!0)},[]),E=(0,g.useCallback)(()=>{h(!1)},[]),u=(0,g.useMemo)(()=>[this.styles["webview-container"],i?this.styles.show:this.styles.hide],[i]),_=(0,g.useCallback)(L=>{this.handleReactNativeWebViewMessage(L)},[]);return g.default.createElement(W.View,{ref:b,style:u},g.default.createElement(ft.WebView,{ref:c,source:{uri:`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`},onMessage:_,style:this.styles["magic-webview"]}))}}init(){this.webView=null,this.container=null,this.styles=Nt()}handleReactNativeWebViewMessage(i){var h;if(i.nativeEvent&&typeof i.nativeEvent.data=="string"&&(i.nativeEvent.url===`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`||i.nativeEvent.url===`${this.endpoint}/send/?params=${this.parameters}`)){let c=JSON.parse(i.nativeEvent.data,(b,v)=>{try{if(v&&typeof v=="object"&&v.flag&&v.flag==="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY")return new global[v.constructor](v.data.split(","))}catch(E){}return v});if(c&&c.msgType&&this.messageHandlers.size){c.response=(h=c.response)!=null?h:{};let b={data:c};for(let v of this.messageHandlers.values())v(b)}}}hideOverlay(){this.container&&this.container.hideOverlay()}showOverlay(){this.container&&this.container.showOverlay()}_post(i){return T(this,null,function*(){if(this.webView&&this.webView.postMessage)this.webView.postMessage(JSON.stringify(i,(h,c)=>(0,ht.isTypedArray)(c)?{constructor:c.constructor.name,data:c.toString(),flag:kt}:c),this.endpoint);else throw(0,Y.createModalNotReadyError)()})}};var ut=require("@magic-sdk/provider"),j=class extends ut.SDKBase{get Relayer(){return this.overlay.Relayer}};f(l,require("@magic-sdk/commons"),module.exports);global.process=mt.merge(global.process,It);global.process.browser=!1;global.Buffer=$.Buffer;global.URL=U.URL;global.URLSearchParams=U.URLSearchParams;global.btoa=n=>$.Buffer.from(n,"binary").toString("base64");global.atob=n=>$.Buffer.from(n,"base64").toString("binary");var Pt=(0,pt.createSDK)(j,{platform:"react-native",sdkName:"@magic-sdk/react-native",version:"11.0.0",bundleId:dt.applicationId,defaultEndpoint:"https://box.magic.link/",ViewController:C,configureStorage:()=>T(void 0,null,function*(){let n=vt.default.createInstance({name:"MagicAuthLocalStorageDB",storeName:"MagicAuthLocalStorage"}),s=(0,yt.driverWithoutSerialization)();return yield Promise.all([n.defineDriver(s),n.defineDriver(X)]),yield n.setDriver([s._driver,X._driver]),n})});0&&(module.exports={Magic});
//# sourceMappingURL=index.js.map
