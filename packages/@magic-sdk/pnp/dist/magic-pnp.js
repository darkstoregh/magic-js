"use strict";var MagicPlugNPlay=(()=>{var N=Object.defineProperty;var T=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(e,n,t)=>n in e?N(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,P=(e,n)=>{for(var t in n||(n={}))K.call(n,t)&&x(e,t,n[t]);if(T)for(var t of T(n))D.call(n,t)&&x(e,t,n[t]);return e};var o=(e,n,t)=>new Promise((i,c)=>{var s=l=>{try{a(t.next(l))}catch(w){c(w)}},d=l=>{try{a(t.throw(l))}catch(w){c(w)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,d);a((t=t.apply(e,n)).next())});var L=document.querySelectorAll("script[data-magic-publishable-api-key]"),_,p=(_=document.currentScript)!=null?_:L[L.length-1];function g(){let e=new URL(p.getAttribute("src")),n=p.dataset.magicPublishableApiKey,t=p.dataset.locale,i=b(p.dataset.redirectUri),c=b(p.dataset.loginUri),s=b(p.dataset.termsOfServiceUri),d=b(p.dataset.privacyPolicyUri),a=!!p.dataset.debug;return{script:p,src:e,apiKey:n,locale:t,redirectURI:i,loginURI:c,termsOfServiceURI:s,privacyPolicyURI:d,debug:a}}function b(e){return e!=null&&e.startsWith("/")?`${window.location.origin}${e}`:e}var I=class extends window.Magic.Extension.Internal{constructor(){super(...arguments);this.config={isPnP:!0};this.name="pnp"}getLoginMethod(t){return this.utils.createPromiEvent(i=>o(this,null,function*(){let c=yield this.utils.storage.getItem(I.storageKeys.lastUsedProvider);i(yield this.request(this.utils.createJsonRpcRequestPayload("pnp/login",[P({lastUsedProvider:c},t)])))}))}showSettings(){return this.request(this.utils.createJsonRpcRequestPayload("pnp/settings"))}saveLastUsedProvider(t){return o(this,null,function*(){t&&(yield this.utils.storage.setItem(I.storageKeys.lastUsedProvider,t))})}encodeUserMetadata(t){return this.utils.encodeJSON(t)}decodeUserMetadata(t){return t?this.utils.decodeJSON(t):null}},M=I;M.storageKeys={lastUsedProvider:"pnp/lastUsedProvider"};function m(e,n,t){let i=q([new M,window.MagicOAuthExtension&&new window.MagicOAuthExtension]);return new window.Magic(e,{endpoint:n,locale:t,extensions:i})}function q(e){return e.filter(Boolean)}function h(){return o(this,null,function*(){let{src:e,apiKey:n,locale:t,redirectURI:i=`${window.location.origin}/callback`,termsOfServiceURI:c,privacyPolicyURI:s,debug:d}=g(),a=m(n,e.origin,t);function l(u){return o(this,null,function*(){yield a.pnp.saveLastUsedProvider(u),yield a.oauth.loginWithRedirect({provider:u,redirectURI:i})})}function w(u){return o(this,null,function*(){yield a.pnp.saveLastUsedProvider("email_link");let r=yield a.auth.loginWithMagicLink({email:u,redirectURI:i});window.location.href=`${i}?didt=${encodeURIComponent(r)}`})}function v(u){return o(this,null,function*(){yield a.pnp.saveLastUsedProvider("sms");let r=yield a.auth.loginWithSMS({phoneNumber:u});window.location.href=`${i}?didt=${encodeURIComponent(r)}`})}let[R,y]=yield a.pnp.getLoginMethod({debug:d,termsOfServiceURI:c,privacyPolicyURI:s});switch(R){case"oauth2":return l(y).catch(h);case"email_link":return w(y).catch(h);case"sms":return v(y).catch(h);default:return h()}})}function E(){return o(this,null,function*(){let{src:e,apiKey:n,locale:t,loginURI:i,redirectURI:c=window.location.origin}=g();yield m(n,e.origin,t).user.logout().catch(()=>{}),window.location.href=i||c})}function U(e,n={}){let t=new CustomEvent("@magic/ready",{detail:P({magic:e},n)});window.dispatchEvent(t)}function A(){return o(this,null,function*(){let{src:e,apiKey:n,locale:t,loginURI:i,redirectURI:c=window.location.origin}=g(),s=window.location.search,d=new URLSearchParams(s),a=m(n,e.origin,t);function l(){let r=window.location.origin+window.location.pathname;window.history.replaceState(null,"",r)}function w(){return o(this,null,function*(){let r=yield a.oauth.getRedirectResult();U(a,{idToken:r.magic.idToken,userMetadata:r.magic.userMetadata,oauth:r.oauth})})}function v(){return o(this,null,function*(){let r=yield a.auth.loginWithCredential(),f=yield a.user.getMetadata();U(a,{idToken:r,userMetadata:f})})}function R(){return o(this,null,function*(){var S,k;let r=yield a.user.getIdToken(),f=(S=a.pnp.decodeUserMetadata(d.get("prev_user_metadata")))!=null?S:void 0,$=(k=a.pnp.decodeUserMetadata(d.get("curr_user_metadata")))!=null?k:yield a.user.getMetadata();l(),U(a,{idToken:r,userMetadata:$,prevUserMetadata:f})})}function y(){return o(this,null,function*(){let r=d.get("didt")||(yield a.user.getIdToken());l();let f=yield a.user.getMetadata();U(a,{idToken:decodeURIComponent(r),userMetadata:f})})}let u=()=>{window.location.href=i||c};switch(W(d)){case"oauth":return w().catch(u);case"magic_credential":return v().catch(u);case"settings":return R().catch(u);default:return y().catch(u)}})}function W(e){return e.get("state")?"oauth":e.get("magic_credential")?"magic_credential":e.get("prev_user_metadata")?"settings":null}function C(){return o(this,null,function*(){let{src:e,apiKey:n,locale:t,redirectURI:i=`${window.location.origin}/callback`,loginURI:c=window.location.origin}=g(),s=m(n,e.origin,t);try{let d=s.pnp.encodeUserMetadata(yield s.user.getMetadata()),a=s.pnp.encodeUserMetadata(yield s.pnp.showSettings());window.location.href=`${i}?prev_user_metadata=${d}&curr_user_metadata=${a}`}catch(d){window.location.href=c}})}function O(){let{src:e}=g();switch(e.pathname){case"/pnp/login":return h();case"/pnp/logout":return E();case"/pnp/callback":return A();case"/pnp/settings":return C();default:return}}["loaded","interactive","complete"].includes(document.readyState)?O():window.addEventListener("load",O,!0);})();
if (MagicPlugNPlay && MagicPlugNPlay.default != null) { MagicPlugNPlay = Object.assign(MagicPlugNPlay.default, MagicPlugNPlay); delete MagicPlugNPlay.default; }
