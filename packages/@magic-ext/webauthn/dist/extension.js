"use strict";var MagicWebAuthnExtension=(()=>{var W=Object.create;var c=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var v=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),N=(e,r)=>{for(var t in r)c(e,t,{get:r[t],enumerable:!0})},f=(e,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of C(r))!x.call(e,n)&&n!==t&&c(e,n,{get:()=>r[n],enumerable:!(a=m(r,n))||a.enumerable});return e};var q=(e,r,t)=>(t=e!=null?W(E(e)):{},f(r||!e||!e.__esModule?c(t,"default",{value:e,enumerable:!0}):t,e)),S=e=>f(c({},"__esModule",{value:!0}),e);var h=(e,r,t)=>new Promise((a,n)=>{var s=o=>{try{u(t.next(o))}catch(p){n(p)}},i=o=>{try{u(t.throw(o))}catch(p){n(p)}},u=o=>o.done?a(o.value):Promise.resolve(o.value).then(s,i);u((t=t.apply(e,r)).next())});var y=v((P,d)=>{d.exports=Magic});var J={};N(J,{default:()=>I});var R=q(y());var U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function w(e){let r,t=e.length%3,a="",n,s;function i(o){return U.charAt(o)}function u(o){return i(o>>18&63)+i(o>>12&63)+i(o>>6&63)+i(o&63)}for(r=0,s=e.length-t;r<s;r+=3)n=(e[r]<<16)+(e[r+1]<<8)+e[r+2],a+=u(n);switch(t){case 1:n=e[e.length-1],a+=i(n>>2),a+=i(n<<4&63),a+="==";break;case 2:n=(e[e.length-2]<<8)+e[e.length-1],a+=i(n>>10),a+=i(n>>4&63),a+=i(n<<2&63),a+="=";break;default:break}return a}function l(e){return w(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function _(e){return w(e).replace(/\+/g,"-").replace(/\//g,"_")}function D(e){return Array.from(e).map(function(r){return`0${r.toString(16)}`.substr(-2)}).join("")}var b=e=>{let r=new Uint8Array(e.response.attestationObject),t=new Uint8Array(e.response.clientDataJSON),a=new Uint8Array(e.rawId),n=e.getClientExtensionResults();return{id:e.id,rawId:l(a),type:e.type,attObj:l(r),clientData:l(t),registrationClientExtensions:JSON.stringify(n)}},A=e=>{let r=new Uint8Array(e.response.authenticatorData),t=new Uint8Array(e.response.clientDataJSON),a=new Uint8Array(e.rawId),n=new Uint8Array(e.response.signature),s=e.getClientExtensionResults();return{id:e.id,rawId:l(a),type:e.type,authData:_(r),clientData:_(t),signature:D(n),assertionClientExtensions:JSON.stringify(s)}};var g=class extends R.Extension.Internal{constructor(){super(...arguments);this.name="webauthn";this.config={}}createWebAuthnNotSupportError(){this.createError("WEBAUTHN_NOT_SUPPORTED","WebAuthn is not supported in this device.",{})}createWebAuthCreateCredentialError(t){this.createError("WEBAUTHN_CREATE_CREDENTIAL_ERROR",`Error creating credential: ${t}`,{})}registerNewUser(t){return h(this,null,function*(){if(!window.PublicKeyCredential)throw this.createWebAuthnNotSupportError();let{username:a,nickname:n=""}=t,s=yield this.request(this.utils.createJsonRpcRequestPayload("magic_auth_webauthn_registration_start",[{username:a}])),i;try{i=yield navigator.credentials.create({publicKey:s.credential_options})}catch(u){throw this.createWebAuthCreateCredentialError(u)}return this.request(this.utils.createJsonRpcRequestPayload("magic_auth_webauthn_register",[{id:s.id,nickname:n,transport:i.response.getTransports(),user_agent:navigator.userAgent,registration_response:b(i)}]))})}login(t){return h(this,null,function*(){if(!window.PublicKeyCredential)throw this.createWebAuthnNotSupportError();let{username:a}=t,n=yield this.request(this.utils.createJsonRpcRequestPayload("magic_auth_login_with_web_authn",[{username:a}])),s;try{s=yield navigator.credentials.get({publicKey:n})}catch(i){throw this.createWebAuthCreateCredentialError(i)}return this.request(this.utils.createJsonRpcRequestPayload("magic_auth_login_with_webauthn_verify",[{username:a,assertion_response:A(s)}]))})}updateInfo(t){let{id:a,nickname:n}=t,s=this.utils.createJsonRpcRequestPayload("magic_user_update_webauthn",[{webAuthnCredentialsId:a,nickname:n}]);return this.request(s)}unregisterDevice(t){let a=this.utils.createJsonRpcRequestPayload("magic_user_unregister_webauthn",[{webAuthnCredentialsId:t}]);return this.request(a)}registerNewDevice(t=""){return h(this,null,function*(){if(!window.PublicKeyCredential)throw this.createWebAuthnNotSupportError();let a=yield this.request(this.utils.createJsonRpcRequestPayload("magic_auth_register_webauthn_device_start",[])),n;try{n=yield navigator.credentials.create({publicKey:a.credential_options})}catch(s){throw this.createWebAuthCreateCredentialError(s)}return this.request(this.utils.createJsonRpcRequestPayload("magic_auth_register_webauthn_device",[{nickname:t,transport:n.response.getTransports(),user_agent:navigator.userAgent,registration_response:b(n)}]))})}getMetadata(){let t=this.utils.createJsonRpcRequestPayload("magic_user_get_webauthn_credentials",[]);return this.request(t)}};var I=g;return S(J);})();
if (MagicWebAuthnExtension && MagicWebAuthnExtension.default != null) { MagicWebAuthnExtension = Object.assign(MagicWebAuthnExtension.default, MagicWebAuthnExtension); delete MagicWebAuthnExtension.default; }
